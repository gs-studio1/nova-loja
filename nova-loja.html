<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FiveM Store - Loja com Categorias</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SDK do Mercado Pago -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #5865F2;
            --primary-dark: #4752c4;
            --secondary: #57F287;
            --dark: #2C2F33;
            --darker: #23272A;
            --light: #FFFFFF;
            --gray: #99AAB5;
        }

        body {
            background-color: var(--darker);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        header {
            background-color: var(--dark);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--gray);
            text-decoration: none;
            transition: color 0.3s;
            font-weight: 500;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 1.3rem;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--secondary);
            color: var(--darker);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--light);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--secondary);
            color: var(--darker);
        }

        .btn-success:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn-category {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--light);
            padding: 0.8rem 1.5rem;
            margin: 0.5rem;
            border-radius: 25px;
            transition: all 0.3s;
        }

        .btn-category:hover, .btn-category.active {
            background: var(--primary);
            transform: translateY(-2px);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            padding: 5rem 2rem;
            text-align: center;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        /* Categories Section */
        .categories-section {
            background: var(--dark);
            padding: 3rem 2rem;
        }

        .categories-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .categories-title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            color: var(--light);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .category-card {
            background: var(--darker);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .category-card.active {
            border-color: var(--secondary);
            background: rgba(87, 242, 135, 0.1);
        }

        .category-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .category-count {
            background: var(--primary);
            color: white;
            padding: 0.2rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        /* Products Grid */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            font-size: 2.5rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .product-card {
            background: var(--dark);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .product-image {
            height: 200px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-category {
            color: var(--primary);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .product-title {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .product-description {
            color: var(--gray);
            margin-bottom: 1rem;
            min-height: 60px;
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
        }

        /* Modais */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--dark);
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 2rem;
            cursor: pointer;
        }

        .cart-items {
            margin-bottom: 1.5rem;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .cart-total {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 2rem 0;
            padding: 1rem;
            background: var(--darker);
            border-radius: 8px;
        }

        /* Checkout Section */
        .checkout-section {
            margin: 2rem 0;
        }

        .payment-methods {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .payment-method {
            flex: 1;
            min-width: 120px;
            text-align: center;
            padding: 1rem;
            background: var(--darker);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-method.active {
            border: 2px solid var(--primary);
        }

        .payment-method i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Discord Section */
        .discord-section {
            background: var(--dark);
            padding: 4rem 2rem;
            text-align: center;
            margin: 2rem 0;
        }

        .discord-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .discord-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* Footer */
        footer {
            background: var(--dark);
            padding: 3rem 2rem 1rem;
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto 2rem;
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: var(--gray);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
            }
            .hero h1 {
                font-size: 2.5rem;
            }
            .categories-grid {
                grid-template-columns: 1fr;
            }
            .products-grid {
                grid-template-columns: 1fr;
            }
            .payment-methods {
                flex-direction: column;
            }
        }

        /* Animações */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification {
            animation: slideIn 0.3s ease;
        }

        /* Notificações */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
        }

        .notification {
            background: var(--secondary);
            color: var(--darker);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .notification.error {
            background: #ff6b6b;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="navbar">
            <div class="logo">
                <i class="fas fa-cogs"></i>
                <span>FiveM Store</span>
            </div>
            <div class="nav-links">
                <a href="#" class="active">Início</a>
                <a href="#categorias">Categorias</a>
                <a href="#produtos">Produtos</a>
                <a href="#discord">Discord</a>
            </div>
            <div class="header-actions">
                <div class="cart-icon" onclick="openCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Loja de Recursos FiveM</h1>
            <p>Scripts, bases, bots e muito mais para o seu servidor. Pagamento seguro via Mercado Pago.</p>
            <button class="btn btn-success" onclick="scrollToCategories()">Ver Categorias</button>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="categories-section" id="categorias">
        <div class="categories-container">
            <h2 class="categories-title">Nossas Categorias</h2>
            <div class="categories-grid" id="categoriesGrid">
                <!-- Categorias carregadas via JavaScript -->
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="container" id="produtos">
        <h2 class="section-title">Nossos Produtos</h2>
        
        <!-- Filtros de Categoria -->
        <div style="text-align: center; margin-bottom: 2rem;">
            <button class="btn-category active" onclick="filterProducts('all')">
                Todos os Produtos <span class="category-count" id="count-all">0</span>
            </button>
            <!-- Botões de categoria serão gerados via JavaScript -->
        </div>
        
        <div class="products-grid" id="productsGrid">
            <!-- Produtos carregados via JavaScript -->
        </div>
    </section>

    <!-- Discord Section -->
    <section class="discord-section" id="discord">
        <div class="discord-content">
            <div class="discord-icon">
                <i class="fab fa-discord"></i>
            </div>
            <h2>Suporte via Discord</h2>
            <p>Entre no nosso Discord para suporte pós-venda e comunidade.</p>
            <button class="btn btn-primary" onclick="joinDiscord()">
                <i class="fab fa-discord"></i> Entrar no Discord
            </button>
        </div>
    </section>

    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🛒 Seu Carrinho</h2>
                <button class="close-modal" onclick="closeCart()">&times;</button>
            </div>
            <div class="cart-items" id="cartItems">
                <!-- Itens do carrinho -->
            </div>
            <div class="cart-total">
                Total: R$ <span id="cartTotal">0,00</span>
            </div>
            <button class="btn btn-success" style="width: 100%;" onclick="openCheckout()">
                💳 Finalizar Compra
            </button>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>💰 Finalizar Pagamento</h2>
                <button class="close-modal" onclick="closeCheckout()">&times;</button>
            </div>
            
            <div class="checkout-section">
                <h3>Resumo do Pedido</h3>
                <div id="checkoutSummary"></div>
                <div class="cart-total">
                    Total: R$ <span id="checkoutTotal">0,00</span>
                </div>
            </div>

            <div class="checkout-section">
                <h3>Escolha a Forma de Pagamento</h3>
                <div class="payment-methods">
                    <div class="payment-method active" onclick="selectPayment('mercado-pago')">
                        <i class="fas fa-credit-card"></i>
                        <div>Mercado Pago</div>
                    </div>
                    <div class="payment-method" onclick="selectPayment('pix')">
                        <i class="fas fa-qrcode"></i>
                        <div>PIX</div>
                    </div>
                </div>
            </div>

            <!-- Container do Mercado Pago -->
            <div id="mercado-pago-checkout" class="payment-container">
                <div id="mercadopago-button"></div>
            </div>

            <!-- Container do PIX -->
            <div id="pix-checkout" class="payment-container" style="display: none;">
                <div style="text-align: center; padding: 2rem;">
                    <i class="fas fa-qrcode" style="font-size: 4rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                    <h3>Pagamento via PIX</h3>
                    <p>Chave PIX: <strong>gustavosaraiva2627@gmail.com</strong></p>
                    <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=PIXfivemstore%40email.com" 
                             alt="QR Code PIX" style="width: 200px; height: 200px;">
                    </div>
                    <p style="color: var(--gray); font-size: 0.9rem;">
                        Após o pagamento, envie o comprovante para nosso Discord.
                    </p>
                    <button class="btn btn-success" onclick="confirmPixPayment()">
                        <i class="fas fa-check"></i> Já Paguei
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div style="text-align: center; padding: 2rem;">
                <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                <h2>🎉 Compra Realizada!</h2>
                <p style="margin: 1rem 0;">Seu pedido foi processado com sucesso!</p>
                <p style="color: var(--gray);">Os produtos serão enviados para seu email em até 24h.</p>
                <div style="margin: 2rem 0; padding: 1rem; background: var(--darker); border-radius: 8px;">
                    <strong>Nº do Pedido:</strong> <span id="orderNumber">#0001</span>
                </div>
                <button class="btn btn-primary" onclick="closeSuccessModal()">
                    <i class="fas fa-home"></i> Voltar à Loja
                </button>
            </div>
        </div>
    </div>

    <!-- Notifications Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <footer>
        <div class="footer-content">
            <div>
                <h3>FiveM Store</h3>
                <p>Loja oficial de recursos para FiveM</p>
            </div>
            <div>
                <h3>Pagamento Seguro</h3>
                <p>Transações protegidas pelo Mercado Pago</p>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2024 FiveM Store. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        // ========== CONFIGURAÇÕES ==========
        const MP_PUBLIC_KEY = 'TEST-12345678-1234-1234-1234-123456789012';
        const MP_ACCESS_TOKEN = 'TEST-1234567890123456-123456-123456789012345678901234567890';

        // ========== DADOS DA LOJA ==========
        const categories = [
            {
                id: 'scripts',
                name: 'Scripts',
                description: 'Sistemas completos para seu servidor',
                icon: 'fas fa-code',
                color: '#5865F2'
            },
            {
                id: 'bases',
                name: 'Bases Prontas',
                description: 'Bases completas para iniciar seu servidor',
                icon: 'fas fa-server',
                color: '#57F287'
            },
            {
                id: 'bots',
                name: 'Bots Discord',
                description: 'Bots integrados com FiveM',
                icon: 'fas fa-robot',
                color: '#FEE75C'
            },
            {
                id: 'interfaces',
                name: 'Interfaces',
                description: 'HUDs e interfaces customizadas',
                icon: 'fas fa-palette',
                color: '#EB459E'
            },
            {
                id: 'vehicles',
                name: 'Veículos',
                description: 'Packs de veículos customizados',
                icon: 'fas fa-car',
                color: '#ED4245'
            },
            {
                id: 'maps',
                name: 'Mapas',
                description: 'Mapas e locais customizados',
                icon: 'fas fa-map',
                color: '#9B59B6'
            }
        ];

        const products = [
            // SCRIPTS
            {
                id: 1,
                name: "Sistema de Empregos Avançado",
                category: "scripts",
                description: "Sistema completo com mais de 15 profissões diferentes e sistema de progressão.",
                price: 49.90,
                icon: "fas fa-briefcase",
                featured: true
            },
            {
                id: 2,
                name: "Sistema de Casas",
                category: "scripts",
                description: "Sistema completo de propriedades com compra, venda e customização.",
                price: 39.90,
                icon: "fas fa-home"
            },
            {
                id: 3,
                name: "Sistema de Gangues",
                category: "scripts",
                description: "Sistema completo de gangues com territórios e hierarquia.",
                price: 44.90,
                icon: "fas fa-users"
            },
            {
                id: 4,
                name: "Sistema de Loja de Armas",
                category: "scripts",
                description: "Sistema completo de loja de armas com diferentes categorias.",
                price: 34.90,
                icon: "fas fa-gun"
            },

            // BASES
            {
                id: 5,
                name: "Base RP Completa",
                category: "bases",
                description: "Base completa para servidor de Roleplay com todos os sistemas essenciais.",
                price: 99.90,
                icon: "fas fa-server",
                featured: true
            },
            {
                id: 6,
                name: "Base FiveM Básica",
                category: "bases",
                description: "Base ideal para iniciantes com sistemas essenciais.",
                price: 59.90,
                icon: "fas fa-cube"
            },

            // BOTS
            {
                id: 7,
                name: "Bot de Economia Discord",
                category: "bots",
                description: "Bot integrado com economia do FiveM e sistema de loja virtual.",
                price: 29.90,
                icon: "fas fa-robot",
                featured: true
            },
            {
                id: 8,
                name: "Bot de Moderação",
                category: "bots",
                description: "Bot completo para moderação do seu servidor Discord.",
                price: 24.90,
                icon: "fas fa-shield-alt"
            },

            // INTERFACES
            {
                id: 9,
                name: "HUD Customizável",
                category: "interfaces",
                description: "HUD moderno e totalmente customizável para seu servidor.",
                price: 34.90,
                icon: "fas fa-tachometer-alt",
                featured: true
            },
            {
                id: 10,
                name: "Interface de Loja Moderna",
                category: "interfaces",
                description: "Interface moderna para lojas com sistema de categorias.",
                price: 29.90,
                icon: "fas fa-shopping-cart"
            },

            // VEÍCULOS
            {
                id: 11,
                name: "Pack Carros Esportivos",
                category: "vehicles",
                description: "Pack com 10 carros esportivos high-poly.",
                price: 39.90,
                icon: "fas fa-car",
                featured: true
            },
            {
                id: 12,
                name: "Pack Motos Custom",
                category: "vehicles",
                description: "Pack com 8 motos customizadas.",
                price: 29.90,
                icon: "fas fa-motorcycle"
            },

            // MAPAS
            {
                id: 13,
                name: "Mapa Casino Moderno",
                category: "maps",
                description: "Mapa completo de cassino com interiores detalhados.",
                price: 49.90,
                icon: "fas fa-dice",
                featured: true
            },
            {
                id: 14,
                name: "Shopping Center",
                category: "maps",
                description: "Mapa de shopping center com várias lojas.",
                price: 39.90,
                icon: "fas fa-store"
            }
        ];

        // ========== VARIÁVEIS GLOBAIS ==========
        let cart = JSON.parse(localStorage.getItem('fivem_cart')) || [];
        let mercadopago;
        let selectedPayment = 'mercado-pago';
        let currentCategory = 'all';

        // ========== INICIALIZAÇÃO ==========
        document.addEventListener('DOMContentLoaded', function() {
            initializeMercadoPago();
            renderCategories();
            renderCategoryFilters();
            renderProducts();
            updateCartCount();
            updateCategoryCounts();
            
            // Verificar status de pagamento na URL
            checkPaymentStatus();
        });

        // ========== SISTEMA DE CATEGORIAS ==========
        function renderCategories() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = categories.map(category => {
                const categoryProducts = products.filter(p => p.category === category.id);
                const featuredProduct = categoryProducts.find(p => p.featured) || categoryProducts[0];
                
                return `
                    <div class="category-card" onclick="filterProducts('${category.id}')">
                        <div class="category-icon">
                            <i class="${category.icon}" style="color: ${category.color}"></i>
                        </div>
                        <h3>${category.name}</h3>
                        <p>${category.description}</p>
                        <div style="margin-top: 1rem;">
                            <small>${categoryProducts.length} produtos disponíveis</small>
                        </div>
                        ${featuredProduct ? `
                            <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(255,255,255,0.1); border-radius: 5px;">
                                <strong>Destaque:</strong> ${featuredProduct.name}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderCategoryFilters() {
            const filtersContainer = document.querySelector('.categories-section + .container .btn-category').parentElement;
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'btn-category';
                button.onclick = () => filterProducts(category.id);
                button.innerHTML = `
                    ${category.name} <span class="category-count" id="count-${category.id}">0</span>
                `;
                filtersContainer.appendChild(button);
            });
        }

        function updateCategoryCounts() {
            // Atualizar contagem para "Todos"
            document.getElementById('count-all').textContent = products.length;
            
            // Atualizar contagem para cada categoria
            categories.forEach(category => {
                const count = products.filter(p => p.category === category.id).length;
                const element = document.getElementById(`count-${category.id}`);
                if (element) {
                    element.textContent = count;
                }
            });
        }

        function filterProducts(category) {
            currentCategory = category;
            
            // Atualizar botões ativos
            document.querySelectorAll('.btn-category').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (category === 'all') {
                document.querySelector('.btn-category').classList.add('active');
            } else {
                document.querySelectorAll('.btn-category').forEach(btn => {
                    if (btn.textContent.includes(categories.find(c => c.id === category)?.name)) {
                        btn.classList.add('active');
                    }
                });
            }
            
            renderProducts();
        }

        // ========== MERCADO PAGO ==========
        function initializeMercadoPago() {
            mercadopago = new MercadoPago(MP_PUBLIC_KEY, {
                locale: 'pt-BR'
            });
        }

        async function createPreference() {
            const items = cart.map(item => ({
                title: item.name,
                unit_price: item.price,
                quantity: item.quantity,
                currency_id: 'BRL'
            }));

            const preference = {
                items: items,
                back_urls: {
                    success: window.location.href + "?status=success",
                    failure: window.location.href + "?status=failure",
                    pending: window.location.href + "?status=pending"
                },
                auto_return: "approved"
            };

            try {
                const response = await fetch('https://api.mercadopago.com/checkout/preferences', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MP_ACCESS_TOKEN}`
                    },
                    body: JSON.stringify(preference)
                });

                const data = await response.json();
                return data.id;
            } catch (error) {
                console.error('Erro ao criar preferência:', error);
                showNotification('Erro no sistema de pagamento. Tente novamente.', 'error');
                return null;
            }
        }

        function renderMercadoPagoButton(preferenceId) {
            mercadopago.checkout({
                preference: {
                    id: preferenceId
                },
                render: {
                    container: '#mercadopago-button',
                    label: 'Pagar com Mercado Pago'
                }
            });
        }

        // ========== SISTEMA DE PRODUTOS ==========
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            const filteredProducts = currentCategory === 'all' 
                ? products 
                : products.filter(p => p.category === currentCategory);
            
            if (filteredProducts.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                        <i class="fas fa-box-open" style="font-size: 4rem; color: var(--gray); margin-bottom: 1rem;"></i>
                        <h3>Nenhum produto encontrado</h3>
                        <p>Não há produtos disponíveis nesta categoria.</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = filteredProducts.map(product => `
                <div class="product-card">
                    <div class="product-image" style="background: linear-gradient(45deg, ${categories.find(c => c.id === product.category)?.color || '#5865F2'}, var(--secondary))">
                        <i class="${product.icon}"></i>
                    </div>
                    <div class="product-info">
                        <div class="product-category">
                            <i class="${categories.find(c => c.id === product.category)?.icon}"></i>
                            ${categories.find(c => c.id === product.category)?.name}
                            ${product.featured ? '<span style="color: var(--secondary); margin-left: 0.5rem;">⭐ Destaque</span>' : ''}
                        </div>
                        <h3 class="product-title">${product.name}</h3>
                        <p class="product-description">${product.description}</p>
                        <div class="product-footer">
                            <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                            <button class="btn btn-primary" onclick="addToCart(${product.id})">
                                <i class="fas fa-cart-plus"></i> Adicionar
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ========== SISTEMA DE CARRINHO ==========
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            
            updateCart();
            showNotification(`✅ ${product.name} adicionado ao carrinho!`);
        }

        function updateCart() {
            localStorage.setItem('fivem_cart', JSON.stringify(cart));
            updateCartCount();
            renderCartItems();
        }

        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.querySelector('.cart-count').textContent = count;
        }

        function renderCartItems() {
            const container = document.getElementById('cartItems');
            const totalElement = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray);">Seu carrinho está vazio</p>';
                totalElement.textContent = '0,00';
                return;
            }
            
            container.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <div>
                        <h4>${item.name}</h4>
                        <small>R$ ${item.price.toFixed(2)} cada</small>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <button class="btn" onclick="changeQuantity(${item.id}, -1)">-</button>
                        <span>${item.quantity}</span>
                        <button class="btn" onclick="changeQuantity(${item.id}, 1)">+</button>
                        <span style="font-weight: bold;">R$ ${(item.price * item.quantity).toFixed(2)}</span>
                        <button class="btn" onclick="removeFromCart(${item.id})" style="color: #ff6b6b;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            totalElement.textContent = total.toFixed(2);
        }

        function changeQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    updateCart();
                }
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCart();
        }

        // ========== MODAIS ==========
        function openCart() {
            renderCartItems();
            document.getElementById('cartModal').style.display = 'block';
        }

        function closeCart() {
            document.getElementById('cartModal').style.display = 'none';
        }

        function openCheckout() {
            if (cart.length === 0) {
                showNotification('Seu carrinho está vazio!', 'error');
                return;
            }

            closeCart();
            
            // Atualizar resumo do checkout
            const summary = document.getElementById('checkoutSummary');
            const total = document.getElementById('checkoutTotal');
            
            summary.innerHTML = cart.map(item => `
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>${item.name} x${item.quantity}</span>
                    <span>R$ ${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            `).join('');
            
            const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            total.textContent = cartTotal.toFixed(2);
            
            // Configurar pagamento
            setupPayment();
            document.getElementById('checkoutModal').style.display = 'block';
        }

        function closeCheckout() {
            document.getElementById('checkoutModal').style.display = 'none';
        }

        function selectPayment(method) {
            selectedPayment = method;
            
            // Atualizar UI
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('active');
            });
            event.target.closest('.payment-method').classList.add('active');
            
            // Mostrar método selecionado
            document.querySelectorAll('.payment-container').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById(`${method}-checkout`).style.display = 'block';
            
            // Configurar pagamento
            setupPayment();
        }

        async function setupPayment() {
            if (selectedPayment === 'mercado-pago') {
                const preferenceId = await createPreference();
                if (preferenceId) {
                    document.getElementById('mercadopago-button').innerHTML = '';
                    renderMercadoPagoButton(preferenceId);
                }
            }
        }

        function confirmPixPayment() {
            // Simular processamento do PIX
            showNotification('Processando pagamento PIX...');
            
            setTimeout(() => {
                closeCheckout();
                showSuccessModal();
            }, 2000);
        }

        function showSuccessModal() {
            // Gerar número de pedido aleatório
            const orderNumber = '#' + Math.random().toString(36).substr(2, 9).toUpperCase();
            document.getElementById('orderNumber').textContent = orderNumber;
            
            // Limpar carrinho
            cart = [];
            updateCart();
            
            document.getElementById('successModal').style.display = 'block';
        }

        function closeSuccessModal() {
            document.getElementById('successModal').style.display = 'none';
        }

        // ========== NOTIFICAÇÕES ==========
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : 'exclamation-triangle'}"></i>
                ${message}
            `;
            
            container.appendChild(notification);
            
            // Remover após 3 segundos
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ========== UTILITÁRIOS ==========
        function scrollToCategories() {
            document.getElementById('categorias').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function joinDiscord() {
            showNotification('Redirecionando para o Discord...');
            // Substitua pelo link real do seu Discord
            setTimeout(() => {
                window.open('https://discord.gg/fivem', '_blank');
            }, 1000);
        }

        function checkPaymentStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            const status = urlParams.get('status');
            
            if (status === 'success') {
                showSuccessModal();
                // Limpar parâmetros da URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (status === 'failure') {
                showNotification('Pagamento recusado. Tente novamente.', 'error');
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // Fechar modais clicando fora
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>